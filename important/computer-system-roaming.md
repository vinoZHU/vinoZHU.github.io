---
title: 《深入理解计算机系统》学习整理--cpu加载数据（粗讲）
date: 2016-05-17 17:58:53
tags:
- 理解计算机
- Linux
categories: 理解计算机

---
本文仅作为一个学习思路整理，细节问题并未涉及。
#### 从一条汇编指令开始
```
movl (%ebp) %edx
```
`%ebp` 和 `%edx`这两个都是寄存器文件，处于CPU中，如图
![](/images/computer-system/computer-system-all.PNG)
每个cpu中都有着有限数量的寄存器在，一个IA32的处理器中包含一组8个存储32位值得寄存器。
一般每个寄存器都会存放特定的数据，例如`%esp`是用来存放栈指针的，`%ebp`是用来存放帧指针的。

`movl A B`指令是将A的数据移动到B（覆盖B的数据），`(%ebp)`中括号的作用是取得主存中地址为`%ebp`的值的数据。也就是说先取得`%ebp`的值，然后将该值作为一个地址，去内存中找到这个地址，获取数据，然后将这个数据赋给`%edx`。

现在来看看这个过程具体是什么样的：
#### 获取虚拟地址
在系统的运行着的每一个进程（程序），它们所接触的都是一个虚拟内存地址，假如系统内存为4G，那么每一个进程在运行时，它都会认为自己拥有着所有的4G内存。假如这些都是物理内存地址，那么每个进程在不经意间都可能会去修改其他进程的数据，造成数据丢失。所以我们从`%ebp`中获取到了一个虚拟地址。

#### 翻译虚拟地址
获取到虚拟地址之后，需要将虚拟地址转换为物理地址。这时候用到了页表和TLB，先检查TLB中是否缓存着对应地址，如果没有，则查看页表。这个时候如果页表命中，则将物理地址返回。如果不命中，将产生缺页异常，需要从磁盘中获取数据，并将数据加载到主存，然后将对应地址记录到页表中。接着翻译机制再从页表中获取物理地址。具体细节以后再整理。

#### 根据物理地址获取数据
cache中存放着主存中的数据，如果缓存命中，则直接将缓存中的数据返回。如果不命中，则cache从主存中获取值，存放到本地（cache）。cpu再向cache发送一次请求，cache将数据发给cpu。


><font color= Darkorange>如若觉得本文尚可，欢迎转载交流。转载请在正文明显处注明[原站地址](http://vinoit.me)以及原文地址，谢谢！</font> 
