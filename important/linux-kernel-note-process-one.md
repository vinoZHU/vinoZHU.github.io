---
title: linux内核笔记之进程（一）
date: 2016-08-15 13:56:35
tags: 
- Linux
- 内核
categories: Linux
---
#### 进程定义
说起进程，真是既熟悉又陌生，感觉知道这个玩意儿，但是又不知该如何说起。按照UTLK中的说法，进程是任何多道程序设计的操作系统中的基本概念，`通常把进程定义为程序执行的一个实例`,貌似大多数OS教科书也是这么定义的。

从内核的角度来看，进程就是消耗系统资源（内存，CPU时间片等）的一个实体。因为每个进程都会有他的执行代码，内核通过调度，让不同的进程可以在CPU上分时执行代码，同时每个进程也都会占用相应的RAM资源。

#### 进程、轻量级进程、线程
现代OS基本上都支持多线程应用程序--拥有很多相对独立执行流的用户程序共享应用程序的大部分数据结构，Linux也一样。在这样的系统中，一个进程由由多个用户线程组成，每个线程都代表进程的一个执行流。

Linux使用轻量级进程对多线程应用程序提供更好的支持。两个轻量进程程基本上可以共享一些资源，只要其中一个修改了共享资源，另一个就立即查看这种修改。实现多线程应用程序的一个简单方式就是把轻量级进程与每个线程关联起来。在Linux中，一个线程组基本上就是实现了多线程应用的一组轻量级进程。

下图描述了几者之间的关系：
![](/images/linux-kernel-note/process-one-0.png)
```
进程P0有四条执行流，也就是线程，
主线程t0是它的第一个线程，与进程P0相关联，
之后衍生出t1、t2、t3三个线程，这三个线程分别与轻量级进程P1、P2、P3相关联，
所有的进程、轻量级进程、线程组成了线程组。
轻量级进程也是进程，只不过它与某进程的某特定线程相关联，而且轻量级进程与原进程之间共享了大部分应用程序的数据结构。
```

pid是进程标识符，tgid是线程组标识符。

每个进程都有自己的pid,同属于一个线程组的所有进程、轻量级进程有同样的tgid，且其为第一个线程所关联的pid。

上图中的所有轻量级进程和进程的tgid均为a,等同于进程的pid。
我们看下两个系统调用的实现，就能发现一些端倪（位于kernel/timer.c）:

```c
asmlinkage long sys_getpid(void)
  {
    return current->tgid;
  }
 asmlinkage long sys_gettid(void)
 {
   return current->pid;
 }
```
从代码里可以清楚的看到，getpid返回的是线程组标识符，gettgid返回的是进程标识符。

#### 总结
本文主要整理了进程的定义以及进程、轻量级进程、线程在Linux中的关系。

><font color= Darkorange>如若觉得本文尚可，欢迎转载交流。转载请在正文明显处注明[原站地址](http://vinoit.me)以及原文地址，谢谢！</font> 